@(request: RequestHeader, messagesApi: MessagesApi)

<link rel="import" href="@routes.Assets.versioned("lib/iron-ajax/iron-ajax.html")">
<link rel="import" href="@routes.Assets.versioned("lib/iron-flex-layout/iron-flex-layout-classes.html")">
<link rel="import" href="@routes.Assets.versioned("lib/iron-form/iron-form.html")">
<link rel="import" href="@routes.Assets.versioned("lib/iron-icons/iron-icons.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-button/paper-button.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-dialog/paper-dialog.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-dropdown-menu/paper-dropdown-menu.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-input/paper-input.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-icon-button/paper-icon-button.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-item/paper-item.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-listbox/paper-listbox.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-styles/color.html")">
<link rel="import" href="@routes.Assets.versioned("lib/paper-styles/typography.html")">

<dom-module id="new-instance-dialog">
  <style>
  #new-instance-form {
    padding-left: 20px;
    padding-right: 20px;
    @@apply(--layout-vertical);
    @@apply(--layout-justified);
  }
  </style>
  <template>
    <paper-dialog id="dialog">
      <h2>New Instance</h2>
      <form is="iron-form" id="new-instance-form" method="post" action="/instances/">
        <template is="dom-if" if="{{isSet(image)}}" restamp="true">
          <span>{{image}}</span>
          <input name="image" type="hidden" value="{{image}}" />
        </template>
        <template is="dom-if" if="{{isNotSet(image)}}" restamp="true">
          <paper-dropdown-menu label="Image" name="image" required>
            <paper-listbox class="dropdown-content">
              <content select=".image-option"></content>
            </paper-listbox>
          </paper-dropdown-menu>
        </template>
        <paper-dropdown-menu label="Cluster" selected-item="{{selectedCluster}}" required>
          <paper-listbox class="dropdown-content" attr-for-selected="value">
            <template is="dom-repeat"
                items="[[availableClusters.clusters]]"
                as="cluster">
              <paper-item value="{{cluster.id}}">{{cluster.display}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <input is="iron-input" name="cluster" type="hidden" value="[[selectedCluster.value]]">
      </form>
      <div class="buttons">
        <paper-button dialog-dismiss on-click="close">Cancel</paper-button>
        <paper-button dialog-confirm on-click="submit">Create</paper-button>
      </div>
    </paper-dialog>
    <iron-ajax
      id="ajax-clusters"
      url="@routes.MainController.getAvailableClusters"
      handle-as="json"
      last-response="{{availableClusters}}">
  </template>
  <script>
  Polymer({
    is: "new-instance-dialog",
    properties: {
      image: {
        type: String,
        value: null
      }
    },
    isSet: function(v) {
      return Boolean(v);
    },
    isNotSet: function(v) {
      return !Boolean(v);
    },
    open: function() {
      this.$['ajax-clusters'].generateRequest();
      this.$.dialog.open();
    },
    close: function() {
      this.$.dialog.opened = true;
      this.$.dialog.close();
    },
    submit: function() {
      this.$['new-instance-form'].submit();
      this.close();
    }
  });
  </script>
</dom-module>